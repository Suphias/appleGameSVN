using AntDesigner.AppleGame;
using AntDesigner.AppleGame.interFace;
using Microsoft.AspNetCore.Http;
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations.Schema;
using System.Linq;
using System.Threading.Tasks;
using WxPayAPI;

namespace AntDesigner.weiXinPay
{
    public class PayOrder : IIdCreateAndModifyTime
    {
        public int id { get; set; }
       public string weixinName{ get; set; }
        public decimal amount { get; set; }
        public bool success { get; set; }
        public string out_trade_no { get; set; }
        public string clientIp { get; set; }
        public string prepay_id { get; set; }
        public string transaction_id { get; set; }

        [DatabaseGenerated(DatabaseGeneratedOption.Computed)]
        public DateTime createTime
        {
            get;set;
        }
        [DatabaseGenerated(DatabaseGeneratedOption.Computed)]
        public DateTime? modifyTime
        {
            get;set;
        }
        public PayOrder()
        { }
        public PayOrder(string weixinName_,decimal amount_)
        {
            success = false;
            weixinName = weixinName_;
            amount = amount_;
        }
        public string createWxJsApiParam()
        {
            JsApiPay jsApiPay = new JsApiPay();
            WxPayData unifiedOrderResult = jsApiPay.GetUnifiedOrderResult(this);
            prepay_id = (string)unifiedOrderResult.GetValue("prepay_id");
            string wxJsApiParam = jsApiPay.GetJsApiParameters();
            return wxJsApiParam;
        }

    }
}
